(()=>{"use strict";var t,e,n,r,o={},s={};function i(t){var e=s[t];if(void 0!==e)return e.exports;var n=s[t]={exports:{}};return o[t](n,n.exports,i),n.exports}i.m=o,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,i.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var o=Object.create(null);i.r(o);var s={};t=t||[null,e({}),e([]),e(e)];for(var l=2&r&&n;("object"==typeof l||"function"==typeof l)&&!~t.indexOf(l);l=e(l))Object.getOwnPropertyNames(l).forEach(t=>s[t]=()=>n[t]);return s.default=()=>n,i.d(o,s),o},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.f={},i.e=t=>Promise.all(Object.keys(i.f).reduce((e,n)=>(i.f[n](t,e),e),[])),i.u=t=>t+"."+{174:"d58022ec4fdd6e88e19f",600:"e4b4d42b2154f9661ee5"}[t]+".js",i.miniCssF=t=>{},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n={},r="river-fight-web:",i.l=(t,e,o,s)=>{if(n[t])n[t].push(e);else{var l,a;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==t||h.getAttribute("data-webpack")==r+o){l=h;break}}l||(a=!0,(l=document.createElement("script")).charset="utf-8",i.nc&&l.setAttribute("nonce",i.nc),l.setAttribute("data-webpack",r+o),l.src=t),n[t]=[e];var d=(e,r)=>{l.onerror=l.onload=null,clearTimeout(f);var o=n[t];if(delete n[t],l.parentNode&&l.parentNode.removeChild(l),o&&o.forEach(t=>t(r)),e)return e(r)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=d.bind(null,l.onerror),l.onload=d.bind(null,l.onload),a&&document.head.appendChild(l)}},i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=n[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{var t={792:0};i.f.j=(e,n)=>{var r=i.o(t,e)?t[e]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise((n,o)=>r=t[e]=[n,o]);n.push(r[2]=o);var s=i.p+i.u(e),l=new Error;i.l(s,n=>{if(i.o(t,e)&&(0!==(r=t[e])&&(t[e]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;l.message="Loading chunk "+e+" failed.\n("+o+": "+s+")",l.name="ChunkLoadError",l.type=o,l.request=s,r[1](l)}},"chunk-"+e,e)}};var e=(e,n)=>{var r,o,[s,l,a]=n,c=0;if(s.some(e=>0!==t[e])){for(r in l)i.o(l,r)&&(i.m[r]=l[r]);if(a)a(i)}for(e&&e(n);c<s.length;c++)o=s[c],i.o(t,o)&&t[o]&&t[o][0](),t[o]=0},n=self.webpackChunkriver_fight_web=self.webpackChunkriver_fight_web||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),(()=>{const t={modes:["net","fake","ai","hotseat","server","match"],mode:"net",debug:!0,wsPort:8088,negotiatedId:3,color:"blue",lang:"",useSound:!1},e=20;function n(t){return Math.floor((t.offsetX+1)/e)}function r(t,e){e(n(t))}function o(t,e,n){const r=e.querySelector("#field-template").content.cloneNode(!0).firstElementChild,o=r.querySelector(".frame-text");return n.t("axis").then(t=>{for(const n of t){const t=e.createElement("span");t.textContent=n,o.appendChild(t)}}),t.appendChild(r),r}let s=null;async function l(t,e,n,r,o){let i=0;const l=await t,a=o.querySelector(".message");n?a.classList.add("enemy"):a.classList.remove("enemy"),a.textContent="",s&&clearInterval(s),s=setInterval(()=>{i<l.length?(a.textContent+=l.charAt(i),++i):(clearInterval(s),s=setTimeout(()=>{a.textContent=""},r))},e)}const a=0,c=1,u=2,h=3,d=4,f=5,g=[{len:3,count:1},{len:2,count:2},{len:1,count:3}];function m(t){return t===a||t>=d?0:1}function p(t,e){return v(t,e,()=>{})}function y(t,e,n){if(!t[n])return d;const r=p(t,n),o=p(e,n);if(o===r)return function(t,e,n){if(t.length!==e.length)throw"Illegal state";for(let r=0;r<t.length;++r)if(r!==n&&t[r]!==m(e[r]))return!1;return!0}(t,e,n)?h:u;if(o<r)return c;throw"Illegal state"}function w(t,e,n,r){let o=e+n,s=0;for(;o<t.length&&o>=0;){if(!m(t[o])){t[o]===a&&r(o);break}o+=n,++s}return s}function v(t,e,n){let r=1;return r+=w(t,e,1,n),r+=w(t,e,-1,n),r}const b=["blue","red"];function C(t){for(const e of b)if(t!==e)return e;return""}function L(t,r){const s=Promise.withResolvers(),i=t.querySelector(".gamename");if(i){r.t("game").then(t=>{i.textContent=t}),t.documentElement.lang=r.getLang()}function a(e){l(e,70,!1,2e3,t)}let c=null,u=0;const h=new Array(18).fill(0);const d=[],f=t.querySelector(".grid"),m=o(f,t,r);m.classList.add("adjust-first");const p=function(t,e){const n=t.createElement("div");return n.classList.add("shipyard"),e.appendChild(n),n}(t,f);function y(n){d.push(function(n){const r=t.createElement("div");return r.classList.add("ship"),r.style.width=n*e+"px",p.appendChild(r),{length:n,html:r}}(n)),++u}for(const t of g)for(let e=0;e<t.count;e++)y(t.len);function w(t,e){if(t.html.classList.contains("disabled"))return!1;c={s:t,n:e};for(const t of d)t.html.classList.remove("choosen");return t.html.classList.add("choosen"),!0}for(const t of d)t.html.addEventListener("click",e=>{e.preventDefault();const r=n(e);w(t,r)});const v=m.querySelector(".river");function b(){m.classList.remove("adjust-first"),m.classList.add("adjust-third"),v.removeEventListener("click",L)}function C(n){if(n<0)return!1;if(null==c)return a(r.t("choose")),!1;const o=n-c.n;if(!function(t,e,n){if(!function(t,e,n){if(e<0)return!1;const r=e-1;if(r>=0&&t[r]>0)return!1;for(let r=0;r<n;r++){const n=e+r;if(n>t.length-1)return!1;if(t[n]>0)return!1}const o=e+n;return!(o<t.length&&t[o]>0)}(t,e,n))return!1;for(let r=0;r<n;r++)t[e+r]=1;return--u,!0}(h,o,c.s.length))return a(r.t("closely")),!1;const i=t.createElement("div");return i.classList.add("ship-river"),i.classList.add("diagonal-line"),i.style.width=c.s.html.style.width,i.style.left=o*e+"px",v.appendChild(i),c.s.html.classList.add("disabled"),c=null,0===u&&s.resolve({field:h,onOpponentReady:b}),!0}function L(t){t.preventDefault();C(n(t))}v.addEventListener("click",L);return{putShip:C,ships:d,choose:w,ready:()=>s.promise}}function E(t,e){return function(t,e,n,r){return e||("https:"!==t?"ws://"+n+":"+r.wsPort:void 0)}(t.protocol,e.wh,t.hostname,e)}function k(t,e){return e.sh||t.origin}let S=null,D="",_="",P=null;function B(t){}const M={recv:B,open:B,socket_open:B,socket_close:B,server_message:B,socket_error:B};let A=null,x=!1;function T(t){const e=new RTCPeerConnection;return e.onicecandidate=function(n){e&&n&&n.candidate&&q("candidate",n.candidate,t)},A=e.createDataChannel("my channel",{negotiated:!0,id:P.negotiatedId}),A.onmessage=function(t){M.recv(t.data)},A.onopen=function(){x=!0,q("close",{},t),M.socket_error=B,t.close(),M.open()},A.onclose=function(){x=!1},A.onerror=function(){},e}function q(t,e,n){const r={from:D,to:_,action:t,data:e};return n.send(JSON.stringify(r))}const O={connect:function(t,e,n,r){P=r,S=new WebSocket(t);let o=null;const s=!e||!n;function i(t){const e=JSON.parse(t);e.from!==D&&(s?M.server_message(t):"candidate"===e.action?function(t,e){e.addIceCandidate(new RTCIceCandidate(t)).catch(t=>{})}(e.data,o):"offer"===e.action?o=function(t){const e=T(S);return e.setRemoteDescription(t).then(()=>e.createAnswer()).then(t=>e.setLocalDescription(t)).then(()=>q("answer",e.localDescription,S)).catch(t=>{}),e}(e.data):"answer"===e.action?function(t,e){e.setRemoteDescription(new RTCSessionDescription(t))}(e.data,o):"connected"===e.action?o=function(){const t=T(S),e={offerToReceiveAudio:!1,offerToReceiveVideo:!1};return t.createOffer(e).then(e=>t.setLocalDescription(e)).then(()=>{q("offer",t.localDescription,S)}).catch(t=>{}),t}():e.action)}S.onopen=function(t){M.socket_open(),s||(D=e,_=n,q("connected",{color:D},S))},S.onclose=function(t){M.socket_close()},S.onmessage=async function(t){if(t.data instanceof Blob){i(await t.data.text())}else i(t.data)},S.onerror=function(e){M.socket_error("url "+t)}},sendMessage:function(t){return!!A&&(!!x&&(A.send(t),x))},on:function(t,e){M[t]=e}};var I=1,R=2,N=4,$=8,F=class{mode;data;constructor(t){this.mode=N,this.data=t}getLength(){return this.data.length}write(t){for(let e=0;e<this.data.length;e++)t.put(this.data.charCodeAt(e),8)}},j={L:1,M:0,Q:3,H:2},H=class t{totalCount;dataCount;constructor(t,e){this.totalCount=t,this.dataCount=e}static RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];static getRSBlocks(e,n){const r=t.getRsBlockTable(e,n);if(null==r)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+n);const o=r.length/3,s=[];for(let e=0;e<o;e++){const n=r[3*e+0],o=r[3*e+1],i=r[3*e+2];for(let e=0;e<n;e++)s.push(new t(o,i))}return s}static getRsBlockTable(e,n){switch(n){case j.L:return t.RS_BLOCK_TABLE[4*(e-1)+0];case j.M:return t.RS_BLOCK_TABLE[4*(e-1)+1];case j.Q:return t.RS_BLOCK_TABLE[4*(e-1)+2];case j.H:return t.RS_BLOCK_TABLE[4*(e-1)+3];default:return}}},G=class{buffer;length;constructor(){this.buffer=[],this.length=0}get(t){const e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)}put(t,e){for(let n=0;n<e;n++)this.putBit(1==(t>>>e-n-1&1))}getLengthInBits(){return this.length}putBit(t){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}},U={glog:function(t){if(t<1)throw new Error("glog("+t+")");return U.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return U.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(let t=0;t<8;t++)U.EXP_TABLE[t]=1<<t;for(let t=8;t<256;t++)U.EXP_TABLE[t]=U.EXP_TABLE[t-4]^U.EXP_TABLE[t-5]^U.EXP_TABLE[t-6]^U.EXP_TABLE[t-8];for(let t=0;t<255;t++)U.LOG_TABLE[U.EXP_TABLE[t]]=t;var z=U,V=class t{num;constructor(t,e){if(null==t.length)throw new Error(t.length+"/"+e);let n=0;for(;n<t.length&&0==t[n];)n++;this.num=new Array(t.length-n+e);for(let e=0;e<t.length-n;e++)this.num[e]=t[e+n]}get(t){return this.num[t]}getLength(){return this.num.length}multiply(e){const n=new Array(this.getLength()+e.getLength()-1);for(let t=0;t<this.getLength();t++)for(let r=0;r<e.getLength();r++)n[t+r]^=z.gexp(z.glog(this.get(t))+z.glog(e.get(r)));return new t(n,0)}mod(e){if(this.getLength()-e.getLength()<0)return this;const n=z.glog(this.get(0))-z.glog(e.get(0)),r=new Array(this.getLength());for(let t=0;t<this.getLength();t++)r[t]=this.get(t);for(let t=0;t<e.getLength();t++)r[t]^=z.gexp(z.glog(e.get(t))+n);return new t(r,0).mod(e)}},X=0,K=1,J=2,Q=3,W=4,Y=5,Z=6,tt=7,et={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){let e=t<<10;for(;et.getBCHDigit(e)-et.getBCHDigit(et.G15)>=0;)e^=et.G15<<et.getBCHDigit(e)-et.getBCHDigit(et.G15);return(t<<10|e)^et.G15_MASK},getBCHTypeNumber:function(t){let e=t<<12;for(;et.getBCHDigit(e)-et.getBCHDigit(et.G18)>=0;)e^=et.G18<<et.getBCHDigit(e)-et.getBCHDigit(et.G18);return t<<12|e},getBCHDigit:function(t){let e=0;for(;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return et.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,n){switch(t){case X:return(e+n)%2==0;case K:return e%2==0;case J:return n%3==0;case Q:return(e+n)%3==0;case W:return(Math.floor(e/2)+Math.floor(n/3))%2==0;case Y:return e*n%2+e*n%3==0;case Z:return(e*n%2+e*n%3)%2==0;case tt:return(e*n%3+(e+n)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){let e=new V([1],0);for(let n=0;n<t;n++)e=e.multiply(new V([1,z.gexp(n)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case I:return 10;case R:return 9;case N:case $:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case I:return 12;case R:return 11;case N:return 16;case $:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case I:return 14;case R:return 13;case N:return 16;case $:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){const e=t.getModuleCount();let n=0;for(let r=0;r<e;r++)for(let o=0;o<e;o++){let s=0;const i=t.isDark(r,o);for(let n=-1;n<=1;n++)if(!(r+n<0||e<=r+n))for(let l=-1;l<=1;l++)o+l<0||e<=o+l||0==n&&0==l||i==t.isDark(r+n,o+l)&&s++;s>5&&(n+=3+s-5)}for(let r=0;r<e-1;r++)for(let o=0;o<e-1;o++){let e=0;t.isDark(r,o)&&e++,t.isDark(r+1,o)&&e++,t.isDark(r,o+1)&&e++,t.isDark(r+1,o+1)&&e++,0!=e&&4!=e||(n+=3)}for(let r=0;r<e;r++)for(let o=0;o<e-6;o++)t.isDark(r,o)&&!t.isDark(r,o+1)&&t.isDark(r,o+2)&&t.isDark(r,o+3)&&t.isDark(r,o+4)&&!t.isDark(r,o+5)&&t.isDark(r,o+6)&&(n+=40);for(let r=0;r<e;r++)for(let o=0;o<e-6;o++)t.isDark(o,r)&&!t.isDark(o+1,r)&&t.isDark(o+2,r)&&t.isDark(o+3,r)&&t.isDark(o+4,r)&&!t.isDark(o+5,r)&&t.isDark(o+6,r)&&(n+=40);let r=0;for(let n=0;n<e;n++)for(let o=0;o<e;o++)t.isDark(o,n)&&r++;return n+=10*(Math.abs(100*r/e/e-50)/5),n}},nt=et,rt=class t{typeNumber;errorCorrectLevel;modules;moduleCount;dataCache;dataList;constructor(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}addData(t){const e=new F(t);this.dataList.push(e),this.dataCache=null}isDark(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);if(null===this.modules)throw new Error("this.modules is null");return this.modules[t][e]}getModuleCount(){return this.moduleCount}make(){if(this.typeNumber<1){let t=1;for(t=1;t<40;t++){const e=H.getRSBlocks(t,this.errorCorrectLevel),n=new G;let r=0;for(let t=0;t<e.length;t++)r+=e[t].dataCount;for(let e=0;e<this.dataList.length;e++){const r=this.dataList[e];n.put(r.mode,4),n.put(r.getLength(),nt.getLengthInBits(r.mode,t)),r.write(n)}if(n.getLengthInBits()<=8*r)break}this.typeNumber=t}this.makeImpl(!1,this.getBestMaskPattern())}makeImpl(e,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(let t=0;t<this.moduleCount;t++){this.modules[t]=new Array(this.moduleCount);for(let e=0;e<this.moduleCount;e++)this.modules[t][e]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,n),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)}setupPositionProbePattern(t,e){for(let n=-1;n<=7;n++)if(!(t+n<=-1||this.moduleCount<=t+n))for(let r=-1;r<=7;r++)if(!(e+r<=-1||this.moduleCount<=e+r))if(0<=n&&n<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=r&&r<=4){if(null===this.modules)throw new Error("this.modules is null");this.modules[t+n][e+r]=!0}else{if(null===this.modules)throw new Error("this.modules is null");this.modules[t+n][e+r]=!1}}getBestMaskPattern(){let t=0,e=0;for(let n=0;n<8;n++){this.makeImpl(!0,n);const r=nt.getLostPoint(this);(0==n||t>r)&&(t=r,e=n)}return e}setupTimingPattern(){if(null===this.modules)throw new Error("this.modules is null");for(let t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(let t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)}setupPositionAdjustPattern(){if(null===this.modules)throw new Error("this.modules is null");const t=nt.getPatternPosition(this.typeNumber);for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++){const r=t[e],o=t[n];if(null==this.modules[r][o])for(let t=-2;t<=2;t++)for(let e=-2;e<=2;e++)this.modules[r+t][o+e]=-2==t||2==t||-2==e||2==e||0==t&&0==e}}setupTypeNumber(t){if(null===this.modules)throw new Error("this.modules is null");const e=nt.getBCHTypeNumber(this.typeNumber);for(let n=0;n<18;n++){const r=!t&&1==(e>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(let n=0;n<18;n++){const r=!t&&1==(e>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}}setupTypeInfo(t,e){if(null===this.modules)throw new Error("this.modules is null");const n=this.errorCorrectLevel<<3|e,r=nt.getBCHTypeInfo(n);for(let e=0;e<15;e++){const n=!t&&1==(r>>e&1);e<6?this.modules[e][8]=n:e<8?this.modules[e+1][8]=n:this.modules[this.moduleCount-15+e][8]=n}for(let e=0;e<15;e++){const n=!t&&1==(r>>e&1);e<8?this.modules[8][this.moduleCount-e-1]=n:e<9?this.modules[8][15-e-1+1]=n:this.modules[8][15-e-1]=n}this.modules[this.moduleCount-8][8]=!t}mapData(t,e){if(null===this.modules)throw new Error("this.modules is null");let n=-1,r=this.moduleCount-1,o=7,s=0;for(let i=this.moduleCount-1;i>0;i-=2)for(6==i&&i--;;){for(let n=0;n<2;n++)if(null==this.modules[r][i-n]){let l=!1;s<t.length&&(l=1==(t[s]>>>o&1));nt.getMask(e,r,i-n)&&(l=!l),this.modules[r][i-n]=l,o--,-1==o&&(s++,o=7)}if(r+=n,r<0||this.moduleCount<=r){r-=n,n=-n;break}}}static PAD0=236;static PAD1=17;static createData(e,n,r){const o=H.getRSBlocks(e,n),s=new G;for(let t=0;t<r.length;t++){const n=r[t];s.put(n.mode,4),s.put(n.getLength(),nt.getLengthInBits(n.mode,e)),n.write(s)}let i=0;for(let t=0;t<o.length;t++)i+=o[t].dataCount;if(s.getLengthInBits()>8*i)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*i+")");for(s.getLengthInBits()+4<=8*i&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(!1);for(;!(s.getLengthInBits()>=8*i||(s.put(t.PAD0,8),s.getLengthInBits()>=8*i));)s.put(t.PAD1,8);return t.createBytes(s,o)}static createBytes(t,e){let n=0,r=0,o=0;const s=new Array(e.length),i=new Array(e.length);for(let l=0;l<e.length;l++){const a=e[l].dataCount,c=e[l].totalCount-a;r=Math.max(r,a),o=Math.max(o,c),s[l]=new Array(a);for(let e=0;e<s[l].length;e++)s[l][e]=255&t.buffer[e+n];n+=a;const u=nt.getErrorCorrectPolynomial(c),h=new V(s[l],u.getLength()-1).mod(u);i[l]=new Array(u.getLength()-1);for(let t=0;t<i[l].length;t++){const e=t+h.getLength()-i[l].length;i[l][t]=e>=0?h.get(e):0}}let l=0;for(let t=0;t<e.length;t++)l+=e[t].totalCount;const a=new Array(l);let c=0;for(let t=0;t<r;t++)for(let n=0;n<e.length;n++)t<s[n].length&&(a[c++]=s[n][t]);for(let t=0;t<o;t++)for(let n=0;n<e.length;n++)t<i[n].length&&(a[c++]=i[n][t]);return a}};function ot(t,e){if(!t)throw new Error(e)}var st={level:"L",padding:1,invert:!1,typeNumber:0,errorsEnabled:!1},it=class{value;level;typeNumber;padding;errorsEnabled;invert;qrCodeData;constructor(t,e={}){const n={...st,...e};this.value=t,this.level=n.level,this.typeNumber=n.typeNumber,this.padding=n.padding,this.invert=n.invert,this.errorsEnabled=n.errorsEnabled}setValue(t){this.value=t,this._clearCache()}getDataSize(){const t=this.getData();return t?t.length:0}_clearCache(){this.qrCodeData=null}_getQrCodeData(t){const e=[],n=this.padding,r=this.invert,o=Array(2*n+t.length).fill(r),s=Array(n).fill(o),i=Array(n).fill(r);return n&&e.push(...s),t.forEach(t=>{const n=[];n.push(...i,...t.map(t=>r?!t:t),...i),e.push(n)}),n&&e.push(...s),e}getData(){if(!this.qrCodeData)try{const t=new rt(this.typeNumber,j[this.level]);if(t.addData(this.value),t.make(),!t.modules)return null;this.qrCodeData=this._getQrCodeData(t.modules),Object.freeze(this.qrCodeData)}catch(t){if(this.errorsEnabled)throw t;return null}return this.qrCodeData}},lt=class{static calculateDimension(t,e){const n="number"==typeof t;return ot(n||"string"==typeof t,"value must be either string or number, instead got "+typeof t),n?t:t.indexOf("%")>0?Math.round(parseFloat(t)/100*e)||0:parseFloat(t)||0}static calculatePosition(t,e,n){const r="number"==typeof t;if(ot(r||"string"==typeof t,"value must be either string or number, instead got "+typeof t),r)return t;if("left"===t||"top"===t)return 0;if("right"===t||"bottom"===t)return n-e;if("center"===t)return Math.round((n-e)/2);const o=t.match(/^(?:(right|bottom|left|top)\s+)?(-?[0-9.]+)(%)?$/);ot(!!o,`Expected position with number, instead got ${t}`);const s="right"===o[1]||"bottom"===o[1],i=!!o[3];let l=parseFloat(o[2])||0;return i&&(l=Math.round(l/100*n)),s&&(l=n-l-e),Math.round(l)}},at={image:null},ct=class extends it{image=null;imageConfig=null;constructor(t,e={}){super(t,e);const n={...at,...e};this.image=n.image}_clearCache(){super._clearCache(),this.imageConfig=null}_getImageSource(t){const e=t.source;return"string"==typeof e?e:e instanceof Image?e.src:e instanceof HTMLCanvasElement?e.toDataURL():null}_getImageConfig(){if(this.imageConfig)return this.imageConfig;if(!(this.image&&this.image.source&&this.image.width&&this.image.height))return null;const t=this.getDataSize();if(!t)return null;const e=this._getImageSource(this.image);if(!e)return null;const n=t-2*this.padding,r=lt.calculateDimension(this.image.width,n),o=lt.calculateDimension(this.image.height,n),s=lt.calculatePosition(this.image.x,r,n)+this.padding,i=lt.calculatePosition(this.image.y,o,n)+this.padding;let l=1;return"number"!=typeof this.image.border&&null!==this.image.border||(l=this.image.border),this.imageConfig={source:e,border:l,x:s,y:i,width:r,height:o},this.imageConfig}getData(){if(this.qrCodeData)return this.qrCodeData;const t=super.getData();if(!t)return t;const e=this._getImageConfig();if(null!==e&&e.width&&e.height&&"number"==typeof e.border){const n=Math.max(e.x-e.border,0),r=Math.max(e.y-e.border,0),o=Math.min(n+e.width+2*e.border,t.length),s=Math.min(r+e.height+2*e.border,t.length);for(let e=r;e<s;e+=1)for(let r=n;r<o;r+=1)t[e][r]=!!this.invert}return t}},ut={fgColor:"#000",bgColor:"#FFF"},ht=class extends ct{fgColor;bgColor;qrCodeSVG=null;height;width;qrCodeDataUrl=null;constructor(t,e={}){super(t,e);const n={...ut,...e};this.fgColor=n.fgColor,this.bgColor=n.bgColor,this.width=n.width,this.height=n.height}_clearCache(){super._clearCache(),this.qrCodeSVG=null,this.qrCodeDataUrl=null}_getDataInt(){const t=this.getData();return t?t.map(t=>t.map(t=>t?1:0)):null}_getRects(){const t=this._getDataInt();if(!t)return null;const e=[],n=t.length-1;for(let r=0;r<=n;r+=1){let o=-1;for(let s=0;s<=n;s+=1){const i=1===t[r][s];if(i&&-1===o&&(o=s),-1!==o&&(s===n||!i)){const n=s-(i?0:1),l=this._processRect(t,o,n,r);l&&e.push(l),o=-1}}}return e}_processRect(t,e,n,r){const o=t.length-1;let s=!1,i=!1,l=0;for(let a=r;a<=o;a+=1){for(let r=e;r<=n;r+=1){if(0===t[a][r]){i=!0;break}}if(i)break;for(let r=e;r<=n;r+=1)1===t[a][r]&&(s=!0,t[a][r]=2);l+=1}return s?{x:e,y:r,width:n-e+1,height:l}:null}_getRelativeRects(){const t=this._getRects();if(!t)return null;const e=[],n={};let r=0;return t.forEach(t=>{const e=`${t.width}:${t.height}`;n[e]?(n[e].count+=1,n[e].id||(n[e].id=`i${r.toString(32)}`,r+=1)):n[e]={count:1,rect:t,relative:!1,id:null}}),t.forEach(t=>{const r=`${t.width}:${t.height}`,o=n[r];o.relative?e.push({id:o.id,x:t.x-o.rect.x,y:t.y-o.rect.y}):(o.id&&(t.id=o.id,o.relative=!0),e.push(t))}),e}_buildSVG(t){const e=this.getDataSize(),n=[`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" shape-rendering="crispEdges" viewBox="0 0 ${e} ${e}"${this.width?` width=${this.width}`:""}${this.height?` height=${this.height}`:""} >`];this.bgColor&&n.push(`<rect x="0" y="0" height="${e}" width="${e}" fill="${this.bgColor}"/>`),t.forEach(t=>{if(t.width&&t.height){const e=t.id?`id="${t.id}" `:"";n.push(`<rect ${e}x="${t.x}" y="${t.y}" height="${t.height}" width="${t.width}" fill="${this.fgColor}"/>`)}else n.push(`<use xlink:href="#${t.id}" x="${t.x}" y="${t.y}"/>`)});const r=this._getImageConfig();return r&&r.width&&r.height&&n.push(`<image xlink:href="${r.source}" x="${r.x}" y="${r.y}" width="${r.width}" height="${r.height}"/>`),n.push("</svg>"),n.join("")}toString(){if(!this.qrCodeSVG){if(!this.getDataSize())return null;const t=this._getRects();if(!t)return null;this.qrCodeSVG=this._buildSVG(t)}return this.qrCodeSVG}toDataUrl(){if(!this.qrCodeDataUrl){if(!this.getDataSize())return null;const t=this._getRelativeRects();if(!t)return null;const e=this._buildSVG(t);this.qrCodeDataUrl=`data:image/svg+xml;base64,${btoa(e)}`}return this.qrCodeDataUrl}};function dt(t){t&&t.remove()}function ft(t,e,n="./assets/boat7.svg"){const r=new URL(t);var o,s;return function(t,e,n){const r=new ht(t,{level:"M",padding:3,image:{source:n,width:"20%",height:"15%",x:"center",y:"center"}});var o;return e.innerHTML=r.toString(),(o=e).addEventListener("click",()=>o.classList.toggle("big")),e}((o=r.toString(),s="/",o.endsWith(s)?o.slice(0,-s.length):o),e,n)}function gt(t,e){const n={method:e};return n[e]=t,JSON.stringify(n)}const mt={parser:function(t,e,n){const r=JSON.parse(t),o=r[r.method];return r.method===e&&n(o),o},toMove:function(t){return gt(t,"move")},toField:function(t){return gt(t,"field")},toRestart:function(t){return gt(t,"restart")}};function pt(t,e){if(!t)throw new Error(e)}function yt(t){const e={};let n=t,r=null;const o=()=>{n="ru-RU"===navigator.language?"ru":"en"},s=()=>n,l=async t=>{if(e[t])return;if(r)return r;r="ru"===t?await i.e(600).then(i.t.bind(i,600,17)):await i.e(174).then(i.t.bind(i,174,17));const n=r.default;e[t]=n,r=null};n||o(),l(s());return{t:t=>(async(t,n)=>(await l(n),e[n][t]))(t,n),detect:o,getLang:s}}function wt(t,n,r){return function(t,n,r,o,s,i){const l=r[t];o[t]=l;const a=y(r,o,t);let c;o[t]=a,c=l?i.querySelector("#ship-template"):i.querySelector("#dot-template2");const u=c.content.cloneNode(!0),h=u.firstElementChild;return l?n?h.classList.add("diagonal-line-enemy"):h.classList.add("diagonal-line"):n&&h.classList.add("enemy"),s.appendChild(u),h.style.left=t*e+"px",h.style.width="20px",{html:h,res:l,verdict:a}}(t,n.isOpponentEnemy,n.realField,n.guessedField,n.htmlRiver,r)}const vt=t=>{t&&t.play()};async function bt(t,e,n){const r=await function(t,e,n){return t===c?n.t("hit"):t===u?n.t("kill"):t===d?n.t("miss"):t===h?e?n.t("loose"):n.t("win"):void 0}(t,e,n);return r+"!"}function Ct(t,e){return t>e?e:t<0?0:t}async function Lt(t,e,n){const r=n.querySelector(".overlay");n.querySelector(".close").addEventListener("click",t=>{t.preventDefault(),r.classList.remove("show")},!1);const o=r.querySelector("h2"),s=await t;o.textContent=s;const i=r.querySelector(".content"),l=await e;i.textContent=l,r.classList.add("show")}function Et(t,n,s,i){pt(n.length===s.length,"Bad size");const c=yt();let f="red"===i.color;l(async function(t,e){let n;return n=t?await e.t("prepare"):await e.t("move"),await e.t("begin")+n}(f,c),70,f,1e5,t);const g=function(t,e){const n={};for(const e of t)n[e]=[];const r=()=>Object.keys(n),o=t=>{const e=n[t];return pt(Array.isArray(e),"No key "+t),e},s=t=>r().includes(t),i=(t,e)=>{pt("function"==typeof e,"bad setup "+t),o(t).push(e)},l=(t,n)=>{const r=o(t);if(0===r.length)return Promise.resolve();const s=()=>{const e=r.map(t=>Promise.try(t,n));return pt(r.length>0,"No handlers2 "+t),pt(void 0!==e[0],"No handlers3 "+t),Promise.allSettled(e)};return e?e.add(s):s()};return{on:i,set:(t,e)=>{n[t]=e},call:l,reset:(t,e)=>{pt(s(t),"No name for reset "+t),n[t]=[],i(t,e)},handler:t=>e=>l(t,e),hasAction:s,actionKeys:r}}(["playerMove","enemyMove","meMove","aiMove","gameover"]),m=g.on,p=g.handler("aiMove"),y=g.handler("meMove"),w=function(t,e,n){const r=o(t,e,n);return r.classList.add("adjust-second"),r.querySelector(".river")}(t.querySelector(".grid"),t,c),b=t.querySelector(".river"),C=t.getElementById("bloop");function L(n,r){v(n.guessedField,r,r=>{!function(t,n,r,o){const s=o.querySelector("#dot-template").content.cloneNode(!0),i=s.firstElementChild;r&&i.classList.add("enemy"),n.appendChild(s),i.style.left=t*e+"px",i.style.width="20px"}(r,n.htmlRiver,n.isOpponentEnemy,t)}),i.useSound&&!n.isOpponentEnemy&&vt(C)}const E={realField:n,guessedField:new Array(n.length).fill(a),htmlRiver:b,onOpponentMiss:y,onOpponentHit:p,isOpponentEnemy:!0},k={realField:s,guessedField:new Array(n.length).fill(a),htmlRiver:w,onOpponentMiss:p,onOpponentHit:y,isOpponentEnemy:!1};function S(e){const n=f?E:k,{verdict:r}=wt(e,n,t);l(bt(r,n.isOpponentEnemy,c),70,n.isOpponentEnemy,1e5,t),r===d?(f=!f,n.onOpponentMiss(r)):r===h?n.isOpponentEnemy?function(e){g.call("gameover",!1),Lt(e.t("loose2"),e.t("next"),t)}(c):function(e){if(g.call("gameover",!0),i.useSound){const e=t.getElementById("tada");vt(e)}Lt(e.t("win"),e.t("good"),t)}(c):(n.onOpponentHit(r),r===u&&L(n,e))}function D(t){f&&(t=Ct(t,n.length-1),g.call("enemyMove",t),S(t))}function _(t){f||(t=Ct(t,n.length-1),g.call("playerMove",t),S(t))}function P(t){r(t,D)}w.addEventListener("click",function(t){r(t,_)});return{size:()=>n.length,fireEnemy:D,firePlayer:_,on:m,enableHotSeat:function(){b.addEventListener("click",P)},isEnemyMove:()=>f}}function kt(t,e,n,r){return e.onOpponentReady(),Et(t,e.field,n,r)}function St(t,e){if(!t)throw e}function Dt(t){return function(t,e){const n=t+Math.random()*(e-t);return Math.floor(n)}(0,t)}function _t(t){let e=function(t){let e=0;for(let n=0;n<t.length;n++)t[n]===a&&++e;return St(e>0,"No empty space"),Dt(e)}(t),n=0;for(;n<t.length&&(t[n]===a&&--e,!(e<0));n++);return St(n<t.length&&n>=0,"No empty space2"),n}function Pt(t){const e=[[0,1,0,0,0,1,0,1,1,0,1,0,1,1,0,1,1,1],[0,1,0,0,1,0,1,0,1,1,0,1,1,0,1,1,1,0],[0,0,0,1,0,1,0,1,0,1,1,1,0,1,1,0,1,1],[1,0,1,0,0,0,1,0,0,1,1,0,1,1,1,0,1,1],[1,0,1,0,0,0,1,1,1,0,1,1,0,1,1,0,0,1],[1,1,1,0,1,1,0,1,1,0,1,0,1,0,0,0,0,1]];return t<0&&(t=Dt(e.length)),e[t]}function Bt(t){const e=new Array(t).fill(a);let n=-1,r=0,o=-1;function s(t,e){if(n<0)return _t(t);if(St(n<t.length,"In bounds"),t[n]=e,e===c){0===r&&(r=0===Dt(2)?-1:1);let e=-1;return w(t,n,r,t=>{e=t}),e>=0?e:(r*=-1,w(t,n,r,t=>{e=t}),e>=0?e:_t(t))}if(e===u)return v(t,n,e=>{t[e]=f}),r=0,_t(t);if(e===d){if(0!==r){r*=-1;let e=-1;return w(t,n,r,t=>{e=t}),e>=0?e:(r=0,_t(t))}return _t(t)}return _t(t)}return{guess:function(t){const n=s(e,t);return St(n>=0&&n<e.length,"In bounds3"),o=n,n},setLastMove:function(t){St(t>=0&&t<e.length,"In bounds"),n=t}}}const Mt=t=>new Promise(e=>setTimeout(e,t));function At(t,e){let n=-1;for(let r=0;r<t.length;r++)if(1===t[r]&&n<0&&(n=r),0===t[r]){if(n>=0&&r-n===e)return n;n=-1}return t.length-n===e?n:-1}function xt(t,e,n){for(let r=e;r<e+n+1;r++)t[r]=0}function Tt(t,e,n){!function(t,e){let n=0,r=0;t.addEventListener("click",t=>{if(t.preventDefault(),r>=e.length)return;++n;const{clicks:o,launch:s}=e[r];return n<o?void 0:(++r,s())})}(t.querySelector(e),n)}function qt(t){const e=Bt(t.size());function n(n){const r=e.guess(n);setTimeout(()=>{t.firePlayer(r)},700)}return t.on("meMove",n),t.on("playerMove",t=>{e.setLastMove(t)}),t.isEnemyMove()||n(),t}function Ot(t){return t.getBattle().then(qt)}function It(t){Tt(document,".secret-code",[{clicks:3,launch:()=>{const e=Pt(-1);return async function(t,e){const n=t.ships;for(const r of n){if(!t.choose(r,0))continue;await Mt(500);const n=At(e,r.length);t.putShip(n)&&xt(e,n,r.length),await Mt(200)}}(t.myField,e)}},{clicks:6,launch:()=>Ot(t)}])}function Rt(t,e,n,r){const o=kt(t,e,Pt(-1),n);return r?function(t){const e=Bt(t.size());function n(n){const r=e.guess(n);setTimeout(()=>{t.fireEnemy(r)},700)}t.on("aiMove",n),t.on("enemyMove",t=>e.setLastMove(t)),t.isEnemyMove()&&n()}(o):o.enableHotSeat(),function(t,e){t.on("gameover",()=>{const t=e.querySelector(".butInstall");t&&t.classList.remove("hidden2")})}(o,t),o}function Nt(t,e,n){const r=new URL(t);r.searchParams.set("color",C(n));const o=e.querySelector(".qrcontainer"),s=e.createElement("div");return s.classList.add("qrcode"),o.appendChild(s),ft(r.toString(),s)}const $t="black";function Ft(t,e){if(!t)return;const n=t.querySelectorAll("rect[fill='#000']");for(const t of n)t.style.fill=e}function jt(t,e,n,r,o){const s=o.createElement("div");s.classList.add("qrcode"),r.appendChild(s),t.searchParams.set("color",n);const i="red"===n?"./assets/boat4.svg":"./assets/boat7.svg";ft(t.toString(),s,i),Ft(s,n),e[n]=s}function Ht(t,e,n,r){!function(t){t.querySelector(".grid").replaceChildren(),t.querySelector(".message").textContent="",t.querySelector(".overlay").classList.remove("show")}(e);const o=L(e,r),s=Promise.withResolvers();t.on("recv",t=>{mt.parser(t,"field",t=>{s.resolve(t)})});const i=async function(t,e,n,r,o,s){const i=await r.ready(),a=i.field;l(s.t("wait"),70,!1,1e5,e),t.sendMessage(mt.toField(a));const c=await o,u=kt(e,i,c,n);return u.on("playerMove",e=>t.sendMessage(mt.toMove(e))),t.on("recv",t=>{mt.parser(t,"move",t=>{u.fireEnemy(t)})}),u.on("gameover",()=>{const r=e.querySelector(".secret-code2"),o=r.textContent;r.textContent="ðŸ”ƒ";const i=new AbortController,{signal:l}=i;r.classList.add("clickable"),r.addEventListener("click",l=>{l.preventDefault(),r.textContent=o,r.classList.remove("clickable"),i.abort(),t.sendMessage(mt.toRestart(n.color)),n.color=C(n.color),requestAnimationFrame(()=>Ht(t,e,n,s))},{signal:l}),t.on("recv",l=>{mt.parser(l,"restart",l=>{r.textContent=o,r.classList.remove("clickable"),i.abort(),n.color=l,requestAnimationFrame(()=>Ht(t,e,n,s))})})}),u}(t,e,n,o,s.promise,r);It({myField:o,getBattle:()=>i})}function Gt(t,e,n,r){const o=n.color,s=E(t.location,n),i=k(t.location,n);let l=null;O.on("socket_open",()=>{l=function(t,e,n){const r=new URL(t);r.searchParams.set("color",C(n)),r.searchParams.set("mode","match");const o=e.querySelector(".qrcontainer"),s=e.createElement("div");return s.classList.add("qrcode"),o.appendChild(s),ft(r.toString(),s)}(i,e,o)}),O.on("socket_error",t=>{}),O.on("socket_close",()=>{dt(l)});const a=e.querySelector(".gamename");if(a){r.t("game").then(t=>{a.textContent=t}),e.documentElement.lang=r.getLang()}O.connect(s,o,C(o),n),O.on("open",()=>(dt(l),Ht(O,e,n,r)))}function Ut(t,e,n,r){const o=L(t,r),s=(async()=>{const r=await o.ready();return Rt(t,r,e,n)})();return{myField:o,getBattle:function(){return s}}}function zt(t,e,n){!function(t,e,n){Tt(e,".secret-code2",[{clicks:3,launch:()=>Ot(n)},{clicks:10,launch:()=>{t.location.href="https://asavan.github.io/"}}])}(t,e,n),It(n)}function Vt(t,e,n){const r=n.mode;let o;const s=yt(n.lang);switch(r){case"ai":o=Ut(e,n,!0,s),zt(t,e,o);break;case"net":o=function(t,e,n,r){const o=n.color;let s=!1;const i=E(t.location,n),a=k(t.location,n);let c=null;const u=Promise.withResolvers(),h=!!i&&!n.showqrfake;if(n.showqrfake&&(c=Nt(a,e,o)),h){O.on("socket_open",()=>{c=Nt(a,e,o)}),O.on("socket_error",()=>{s=!0}),O.on("socket_close",()=>{dt(c)});try{O.connect(i,o,C(o),n)}catch(t){s=!0}O.on("open",()=>{s=!1}),O.on("recv",t=>{mt.parser(t,"field",t=>{u.resolve(t)})})}else s=!0;const d=L(e,r),f=(async()=>{const t=await d.ready();if(s)return dt(c),Rt(e,t,n,s);const o=t.field;l(r.t("wait"),70,!1,1e5,e);const i=O.sendMessage(mt.toField(o)),a=await u;i||O.sendMessage(mt.toField(o));const h=kt(e,t,a,n);return h.on("playerMove",t=>O.sendMessage(mt.toMove(t))),O.on("recv",t=>{mt.parser(t,"move",t=>{h.fireEnemy(t)})}),h})();return{myField:d,getBattle:()=>f}}(t,e,n,s),zt(t,e,o);break;case"server":!function(t,e,n){const r=E(t.location,n),o=k(t.location,n),s={};{const t=new URL(o);t.searchParams.delete("mode");const n=e.querySelector(".qrcontainerserver");jt(t,s,"blue",n,e),jt(t,s,"red",n,e)}O.on("socket_open",()=>{Ft(s.blue,"royalblue")}),O.on("server_message",t=>{const e=JSON.parse(t);"connected"===e.action?Ft(s[e.from],$t):"close"===e.action&&dt(s[e.from])});try{O.connect(r,$t,null,n)}catch(t){}}(t,e,n);break;case"hotseat":o=Ut(e,n,!1,s),It(o);break;case"match":Gt(t,e,n,s)}}function Xt(t){switch(t?.toLowerCase()?.trim()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case"":case null:return!1;default:return Boolean(t)}}!function(e,n){!function(t,e){const n=new URLSearchParams(t),r=[];for(const[t,o]of n)"number"==typeof e[t]?e[t]=Number.parseInt(o,10):"boolean"==typeof e[t]?e[t]=Xt(o):e[t]=o,r.push(t)}(e.location.search,t),Vt(e,n,t)}(window,document)})()})();